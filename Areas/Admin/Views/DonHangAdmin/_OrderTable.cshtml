@model IEnumerable<TechStore.Models.HoaDon>

<div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
            <tr>
                <th class="ps-4">Mã ĐH</th>
                <th>Khách hàng</th>
                <th>Ngày đặt</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th class="text-end pe-4">Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                @foreach (var item in Model)
                {
                    var tongTien = item.ChiTietHoaDons?.Sum(ct => ct.DonGia * ct.SoLuong) ?? 0;
                    
                    // Hiệu ứng nhấp nháy cho đơn hàng mới (Trạng thái 0)
                    var rowClass = item.MaTrangThai == 0 ? "table-warning" : "";

                    <tr class="@rowClass">
                        <td class="ps-4 fw-bold">#@item.MaHd</td>
                        <td>
                            <div class="fw-bold">@(item.HoTenNguoiNhan ?? item.MaKhNavigation?.HoTen ?? "Khách vãng lai")</div>
                            <div class="small text-muted"><i class="bi bi-telephone"></i> @item.SdtnguoiNhan</div>
                        </td>
                        <td>
                            <div>@item.NgayDat?.ToString("dd/MM/yyyy")</div>
                            <div class="small text-muted">@item.NgayDat?.ToString("HH:mm")</div>
                        </td>
                        <td class="text-danger fw-bold">@tongTien.ToString("#,##0")₫</td>
                        <td>
                            @{
                                var statusName = item.MaTrangThaiNavigation?.TenTrangThai ?? "N/A";
                                var badgeClass = item.MaTrangThai switch {
                                    0 => "bg-warning text-dark", // Mới
                                    1 => "bg-info",              // Duyệt
                                    2 => "bg-primary",           // Giao
                                    3 => "bg-success",           // Xong
                                    -1 => "bg-secondary",        // Hủy
                                    _ => "bg-light text-dark"
                                };
                            }
                            <span class="badge @badgeClass">@statusName</span>
                        </td>
                        <td class="text-end pe-4">
                            <a href="/Admin/DonHang/Detail/@item.MaHd" class="btn btn-sm btn-primary shadow-sm">
                                Xem & Xử lý <i class="bi bi-arrow-right"></i>
                            </a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="6" class="text-center py-5 text-muted">Không tìm thấy đơn hàng nào.</td></tr>
            }
        </tbody>
    </table>
</div>